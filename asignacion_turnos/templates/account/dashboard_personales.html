{% extends 'base.html' %}
{% load static %}

{% block styles %}
<style>
  body {
    background-color: white;
  }
</style>
{% endblock %}

{% block content %}
<section class="usuario-bar-section">
<div class="usuario-bar d-flex align-items-center justify-content-between px-3">

<!-- Sección Izquierda: Foto + Usuario -->
<div class="usuario-bar-logo-nombre">
    <span class="material-symbols-outlined mb-1" style="color: white; font-size: 46px;">account_circle</span>
  <div class="d-flex flex-column align-items-center flex-shrink-0">
  
    <!-- Nombre del usuario -->
    <div class="saludo" style="color: white; font-weight: 500;">Dashboard</div>

    <!-- Título de la página -->
    <div class="saludo" style="color: #5a9138; font-size: 11px;">Graficas y Metricas</div>
  </div>
  <div class="usuario-bar-centro">
    
  </div>
  </div>
</div>
</section>

<!--Variables que llegan con el render -->
{{ solicitudesXmes|json_script:"meses-data" }}
{{ solicitudesXtotales|json_script:"totales-data" }}
{{ solicitudesXuni|json_script:"uni-data" }}
{{ cantidadXuni|json_script:"cant-data"}}


<section class="contenedorGraficos">
<div id="graficoCircularAcademicas" style="width: 500px;height:400px;"></div>
<div id="graficoBarraUniversidad" style="width: 700px;height:400px;"></div>

</section>

<section class="contenedorGraficos">
  <div id="graficoBarras" style="width: 1000px; height:300px;"></div>
</section>




{% endblock %}

{% block scripts %}

<!--DOM-->
<script>
  document.addEventListener("DOMContentLoaded", function (){
    const content = document.getElementById("mainContent");
    content.style.background = "white";
  })
</script>


 <script>
    
  const aprobadasAcademicas = "{{ porcentajeAprobacion }}"
  const desaprobadasAcademicas = "{{ porcentajeDesaprobadas }}"
  const pendientesAcademicas = "{{ porcentajePendientes }}"
  const totalAcademicas = "{{ numSolicitudesTotal }}"
  const fechaInicialAcademicas = "{{ fechaIni }}"
  const fechaFinalAcademicas = "{{ fechaFin }}"


  const meses = JSON.parse(document.getElementById("meses-data").textContent);
  const totales = JSON.parse(document.getElementById("totales-data").textContent);

  const universidades = JSON.parse(document.getElementById("uni-data").textContent);
  const cantidadXuni = JSON.parse(document.getElementById("cant-data").textContent);


  const mesesFormateados = meses.map(item => item.mes);
  const totalesFormateados = totales.map(item => item.total);

  const uniFormateadas = universidades.map(item => item.nombre);
  const cantFormateadas = cantidadXuni.map(item => item.cantidad);

 </script>

<!--Graficos circulares-->
<script>
const graficoCircular = echarts.init(document.getElementById('graficoCircularAcademicas'));
  option = {
  title: {
    text: `Tipo académicas `,
    subtext: `Aprobadas entre: ${fechaInicialAcademicas} - ${fechaFinalAcademicas}\n  \nTotal solicitudes: ${totalAcademicas}`,
    left: 'center'
  },
  tooltip: {
    trigger: 'item'
  },
  legend: {
    orient: 'vertical',
    left: 'left'
  },
  series: [
    {
      name: 'Porcentajes',
      type: 'pie',
      radius: '50%',
      data: [
        { value: aprobadasAcademicas, name: 'Aprobadas', itemStyle: {color: '#587bf3'}},
        { value: desaprobadasAcademicas, name: 'Desaparobadas',itemStyle: {color: '#B5422B'}},
        { value: pendientesAcademicas, name: 'Pendientes', itemStyle: {color: '#807979'}},
      ],
      emphasis: {
        itemStyle: {
          shadowBlur: 10,
          shadowOffsetX: 0,
          shadowColor: 'rgba(0, 0, 0, 0.5)'
        }
      }
    }
  ]
};
graficoCircular.setOption(option);


</script>

<!--Grafico barras de abajo -->
<script>
const graficoBarras = echarts.init(document.getElementById('graficoBarras'));
option = {
   title: {
    text: `Distribución de solitudes academicas por mes, desde ${fechaInicialAcademicas} - hasta: ${fechaFinalAcademicas}`,
    left: 'center'
  },
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'shadow'
    }
  },
  grid: {
    left: '3%',
    right: '4%',
    bottom: '3%',
    containLabel: true
  },
  xAxis: [
    {
      type: 'category',
      data: mesesFormateados,
      axisTick: {
        alignWithLabel: true
      }
    }
  ],
  yAxis: [
    {
      type: 'value'
    }
  ],
  series: [
    {
      name: 'Cantidad',
      type: 'bar',
      barWidth: '60%',
      data: totalesFormateados
    }
  ]
};
graficoBarras.setOption(option)
</script>

<!--Grafico barras horizontal animado-->
<script>
const graficoBarraUniversidad = echarts.init(document.getElementById("graficoBarraUniversidad"));

option = {
  title: {
    text: 'Universidades',
    subtext: 'Solicitudes por universidades',
    left: 'center'
  },
  xAxis: {
    max: 'dataMax'
  },
  yAxis: {
    type: 'category',
    data: uniFormateadas,
    inverse: true,
    animationDuration: 6000,
    animationDurationUpdate: 6000,
    max: 2 // only the largest 3 bars will be displayed
  },
  series: [
    {
      realtimeSort: true,
      name: 'Universidades',
      type: 'bar',
      data: cantFormateadas,
      label: {
        show: true,
        position: 'right',
        valueAnimation: true
      }
    }
  ],
  legend: {
    show: true
  },
  animationDuration: 2000,
  animationDurationUpdate: 2000,
  animationEasing: 'linear',
  animationEasingUpdate: 'linear'
};

function run() {
 
  graficoBarraUniversidad.setOption({
    series: [
      {
        type: 'bar',
        data
      }
    ]
  });
}


graficoBarraUniversidad.setOption(option)

setTimeout(function () {
  run();
}, 0);
setInterval(function () {
  run();
}, 1000);



</script>
{% endblock %}