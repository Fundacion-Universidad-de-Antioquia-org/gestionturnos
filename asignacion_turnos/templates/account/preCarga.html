{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="usuario-bar position-relative">
  <div class="usuario-bar-logo-nombre">
      <span class="material-symbols-outlined mb-1" style="color: white; font-size: 46px;">account_circle</span>
      <div class="d-flex flex-column align-items-center flex-shrink-0">
  
    <!-- Nombre del usuario -->
    <div class="saludo" style="color: white; font-weight: 500;">
      {{ usuarioLogeado }}
    </div>

    <!-- Título de la página -->
    <div class="saludo" style="color: #ccc; font-size: 11px;">
      Pre-carga 
    </div>
</div>
  </div>

  <!-- Derecha -->
  <form action="{% url 'logout' %}" method="post" class="flex-shrink-0">
    {% csrf_token %}
    <button class="btn btn-sm btn-danger" type="submit">Cerrar sesión</button>
  </form>
</div>

<!-- Acordeon carga de archivos-->
<div class="accordion-container"  style="margin-top: 14px;">
  <div class="accordion-header"> Carga de Archivos | Pre-carga</div>
  <div class="accordion-body" id="acordeonCarga">
   
    <form action="{% url 'preCarga' %}" method="POST" id="formCargaDatos" enctype="multipart/form-data">
      {% csrf_token %}  
      <div class="filtros-horizontal">
        <div class="filtros-horizontal">
  <div class="filtro-item filtro">
    <label for="file_cargarDatosProno">Datos de revisión - PRONO</label>
    <input type="file" name="file_cargarDatosProno" id="archivoRevision" class="input-archivo">
  </div>
  
</div>
      </div>
      <div style="margin-top: 15px;">
        <button type="submit" class="btn btn-primary" name="action" value="cargar" id="btnCargar">Cargar archivos</button>
      </div>
    </form>
  </div>
</div>

<div id="panelControl">
  <span class="material-symbols-outlined">shield_person</span><div class="titulo-template">Empleados que sobrepasan los 7 dias laborados</div> 
</div>
<table class="styled-table display" id="tablaDatos">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Codigo</th>
      <th>Cédula</th>
      <th>Días sin descanso</th>
      <th>Estado</th>
      <th>Semana uno</th>
      <th>Semana dos</th>
    </tr>
  </thead>
  <tbody id="tablaBody" >
    {% for r in dfresultado %}
    <tr>
      <td>{{ r.NOMBRE }}</td>
      <td>{{ r.CODIGO }}</td>
      <td>{{ r.CEDULA }}</td>
      <td><span>{{ r.DIAS_SIN_DESCANSO }}</span></td>
      <td>{{ r.ESTADO }}</td>
      <td>{{ r.DESCANSO_SEM1 }}</td>
      <td>{{ r.DESCANSO_SEM2 }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="12">No hay registros para validar</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<div id="panelControl" >  
  <span class="material-symbols-outlined">error</span><div class="titulo-template">Servicios repetidos</div>
</div>

<table class="styled-table display" id="tablaDatosServiciosRepetidos">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Nombre</th>
      <th>Codigo</th>
      <th>Estación inicial</th>
      <th>Estación final</th>
      <th>Rd_equipo</th>
      <th>Turno</th>
      <th>Cargo</th>
      <th>Dia semana</th>
    </tr>
  </thead>
  <tbody>
    {% for r in serviciosRepetidos %}
    <tr>
      <td>{{ r.FECHA|date:"Y-m-d" }}</td>
      <td>{{ r.Nombre }}</td>
      <td>{{ r.CODPER }}</td>
      <td>{{r.Estacion_ent }}</td>
      <td>{{ r.Estacion_sal }}</td>
      <td>{{ r.RD_EQUIPO }}</td>
      <td>{{ r.CUBIERTO }}</td>
      <td>{{ r.CARGO }}</td>
      <td>{{ r.DIA_SEMANA }}</td>
    </tr>
    {% empty %}
    <tr>
       <td colspan="12">No hay registros para validar</td>
    </tr>
    {% endfor %}  
  </tbody>
</table>


<div id="panelControl" >  
  <span class="material-symbols-outlined">error</span><div class="titulo-template">Servicios Faltantes</div>
</div>

{% endblock %}


{% block scripts %}

<!--Script DOM-->
<script>
    document.addEventListener("DOMContentLoaded",function(){
         Swal.fire({
                title: "¡Bienvenido!",
                text: "LOS DATOS DE PRONO DEBEN SER LA PRIMER HOJA DEL ARCHIVO DE EXCEL",
                icon: "success"
              })
      
    })
</script>
<script>
      // Acordeón toggle
    document.querySelectorAll('.accordion-header').forEach(hdr => {
      hdr.addEventListener('click', () => {
        hdr.classList.toggle('active');
        const body = hdr.nextElementSibling;
        body.classList.toggle('active');
      });
    });
</script>


<script>
  const indiceColumna = 3
  const filas = document.querySelectorAll("#tablaDatos tr")
  filas.forEach((fila,index)=>{
       if(index === 0) return;

       const celda = fila.cells[indiceColumna];
       
       if(celda){
        const span = celda.querySelector("span");
        dias = parseInt(span.textContent,10);
  
        if(dias >= 1){
          span.style.backgroundColor = "#c51010";
          span.style.color = "white";
          span.style.padding = "7px"; 
          span.style.borderRadius = "8px"; 
        }
        

       }
  })

</script>


{% endblock %}